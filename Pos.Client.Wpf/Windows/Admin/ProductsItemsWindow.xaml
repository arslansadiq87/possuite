<Window x:Class="Pos.Client.Wpf.Windows.Admin.ProductsItemsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Products  &amp; Items" Height="720" Width="1080" WindowStartupLocation="CenterOwner">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Top bar -->
            <RowDefinition Height="*"/>
            <!-- Body -->
            <RowDefinition Height="Auto"/>
            <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- Top bar: shared search + filter + actions -->
        <Grid Grid.Row="0" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <!-- Search: -->
                <ColumnDefinition Width="280"/>
                <!-- TextBox -->
                <ColumnDefinition Width="Auto"/>
                <!-- Find -->
                <ColumnDefinition Width="Auto"/>
                <!-- Refresh -->
                <ColumnDefinition Width="*"/>
                <!-- spacer -->
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <!-- Brands -->
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0" Style="{StaticResource ModernTextBlock}"/>
            <TextBox   Grid.Column="1" x:Name="SearchBox" Height="28" VerticalContentAlignment="Center"
               ToolTip="Product name, brand, SKU, or item barcode/name" Style="{StaticResource ModernTextBox}"/>
            <Button    Grid.Column="2" Content="Find"     Width="80" Margin="8,0,0,0" Click="Find_Click" Style="{StaticResource ModernButton}"/>
            <Button    Grid.Column="3" Content="Refresh"  Width="90" Margin="8,0,0,0" Click="Refresh_Click" Style="{StaticResource ModernButton}"/>
            <!-- column 4 is the stretch spacer -->
            <Button    Grid.Column="5" Content="Brands"   Width="90" Margin="8,0,0,0" Click="Brands_Click" Style="{StaticResource ModernButton}"/>
            <Button    Grid.Column="6" Content="Categories"   Width="90" Margin="8,0,0,0" Click="Categories_Click" Style="{StaticResource ModernButton}"/>
        </Grid>


        <!-- Body: Left tabs (Products / Standalone Items) and Right editable grid -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="420"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Tabs -->
            <TabControl x:Name="LeftTabs" Grid.Column="0" SelectionChanged="LeftTabs_SelectionChanged" Style="{StaticResource ModernTabControl}">
                <!-- PRODUCTS TAB -->
                <TabItem Header="Products" Style="{StaticResource ModernTabItem}">
                    <DockPanel>
                        <ToolBar DockPanel.Dock="Top"
                 Style="{StaticResource ModernToolBar.Compact}"
                 ToolBarTray.IsLocked="True">
                            <!-- keeps one row -->
                            <Button Content="New Product" ToolBar.OverflowMode="Never" Click="NewProduct_Click"/>
                            <Button Content="Add Variants" ToolBar.OverflowMode="Never" Click="AddVariants_Click"/>
                            <Separator/>
                            <Button Content="Delete Product" ToolBar.OverflowMode="Never" Click="DeleteProduct_Click"/>
                            <Button Content="Void Product" ToolBar.OverflowMode="Never" Click="VoidProduct_Click"/>
                        </ToolBar>

                        <ListBox x:Name="ProductsList"
                 Style="{StaticResource ModernListBox}"
                 ItemContainerStyle="{StaticResource ModernListBoxItem}"
                 SelectionMode="Single"
                 SelectionChanged="ProductsList_SelectionChanged"
                 DisplayMemberPath="Name"/>
                    </DockPanel>
                </TabItem>

                <!-- STANDALONE ITEMS TAB -->
                <TabItem Header="Standalone Items" Style="{StaticResource ModernTabItem}">
                    <DockPanel>
                        <ToolBar DockPanel.Dock="Top" Style="{StaticResource ModernToolBar.Compact}"
                            ToolBarTray.IsLocked="True">
                            <Button Content="New Item" Click="NewStandaloneItem_Click" ToolBar.OverflowMode="Never"/>
                            <Separator/>
                            <Button Content="Delete Item" Click="DeleteStandaloneItem_Click" ToolBar.OverflowMode="Never"/>
                            <Button Content="Void Item" Margin="8,0,0,0" Click="VoidStandaloneItem_Click" ToolBar.OverflowMode="Never"/>
                        </ToolBar>

                        <ListBox x:Name="StandaloneList" Style="{StaticResource ModernListBox}"
                                ItemContainerStyle="{StaticResource ModernListBoxItem}"
                                 DisplayMemberPath="Name"
                                 SelectionChanged="StandaloneList_SelectionChanged"/>
                    </DockPanel>
                </TabItem>
            </TabControl>

            <Border Grid.Column="1"/>

            <!-- RIGHT: Editable grid (shows product variants OR standalone items) -->
            <GroupBox Grid.Column="2" Style="{StaticResource ModernGroupBox}">
                <GroupBox.Header >
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Edit " />
                        <TextBlock x:Name="GridTitle" FontWeight="Bold" Text="Variants"/>
                    </StackPanel>
                </GroupBox.Header>
                <DockPanel>
                    <ToolBar DockPanel.Dock="Top" Style="{StaticResource ModernToolBar.Compact}"
                        ToolBarTray.IsLocked="True">
                        <Button Content="Save Changes" Click="SaveVariants_Click"/>
                    </ToolBar>
                    <DataGrid x:Name="VariantsGrid" Style="{StaticResource ModernDataGrid}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="True"
                              CanUserDeleteRows="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn x:Name="ColSku" Header="SKU"
                        Binding="{Binding Sku, UpdateSourceTrigger=PropertyChanged}" Width="140"/>

                            <DataGridTextColumn x:Name="ColBarcode" Header="Barcode"
                        Binding="{Binding Barcode, UpdateSourceTrigger=PropertyChanged}" Width="120"/>

                            <!-- Hide this in Variants mode -->
                            <DataGridTextColumn x:Name="ColName" Header="Name"
                        Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Width="200"/>

                            <DataGridTextColumn x:Name="ColPrice" Header="Price"
                        Binding="{Binding Price, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Width="90"/>

                            <!-- Variant axes (hide in Standalone) -->
                            <DataGridTextColumn x:Name="ColVar1Name" Header="Var1 Name"
                        Binding="{Binding Variant1Name, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                            <DataGridTextColumn x:Name="ColVar1Value" Header="Var1 Value"
                        Binding="{Binding Variant1Value, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                            <DataGridTextColumn x:Name="ColVar2Name" Header="Var2 Name"
                        Binding="{Binding Variant2Name, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                            <DataGridTextColumn x:Name="ColVar2Value" Header="Var2 Value"
                        Binding="{Binding Variant2Value, UpdateSourceTrigger=PropertyChanged}" Width="100"/>

                            <!-- Brand & Category dropdowns (searchable via IsEditable/IsTextSearch...) -->
                            <DataGridComboBoxColumn x:Name="ColBrand"
                            Header="Brand"
                            SelectedValueBinding="{Binding BrandId, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                            SelectedValuePath="Id"
                            DisplayMemberPath="Name"
                            Width="140">
                                <DataGridComboBoxColumn.ElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, Path=DataContext._brands}"/>
                                        <Setter Property="IsReadOnly" Value="True"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>
                                        <Setter Property="Focusable" Value="False"/>
                                    </Style>
                                </DataGridComboBoxColumn.ElementStyle>
                                <DataGridComboBoxColumn.EditingElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, Path=DataContext._brands}"/>
                                        <Setter Property="IsEditable" Value="True"/>
                                        <Setter Property="IsTextSearchEnabled" Value="True"/>
                                        <Setter Property="StaysOpenOnEdit" Value="True"/>
                                    </Style>
                                </DataGridComboBoxColumn.EditingElementStyle>
                            </DataGridComboBoxColumn>

                            <DataGridComboBoxColumn x:Name="ColCategory"
                            Header="Category"
                            SelectedValueBinding="{Binding CategoryId, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                            SelectedValuePath="Id"
                            DisplayMemberPath="Name"
                            Width="160">
                                <DataGridComboBoxColumn.ElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, Path=DataContext._categories}"/>
                                        <Setter Property="IsReadOnly" Value="True"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>
                                        <Setter Property="Focusable" Value="False"/>
                                    </Style>
                                </DataGridComboBoxColumn.ElementStyle>
                                <DataGridComboBoxColumn.EditingElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, Path=DataContext._categories}"/>
                                        <Setter Property="IsEditable" Value="True"/>
                                        <Setter Property="IsTextSearchEnabled" Value="True"/>
                                        <Setter Property="StaysOpenOnEdit" Value="True"/>
                                    </Style>
                                </DataGridComboBoxColumn.EditingElementStyle>
                            </DataGridComboBoxColumn>

                            <!-- Tax & Discounts (editable) -->
                            <DataGridTextColumn x:Name="ColTaxCode" Header="Tax Code"
                        Binding="{Binding TaxCode, UpdateSourceTrigger=PropertyChanged}" Width="90"/>
                            <DataGridTextColumn x:Name="ColTaxPct" Header="Tax %"
                        Binding="{Binding DefaultTaxRatePct, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Width="70"/>
                            <DataGridCheckBoxColumn x:Name="ColTaxIncl" Header="Tax Incl."
                            Binding="{Binding TaxInclusive, UpdateSourceTrigger=PropertyChanged}" Width="70"/>

                            <DataGridTextColumn x:Name="ColDiscPct" Header="Disc %"
                        Binding="{Binding DefaultDiscountPct, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Width="70"/>
                            <DataGridTextColumn x:Name="ColDiscAmt" Header="Disc Amt"
                        Binding="{Binding DefaultDiscountAmt, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Width="80"/>

                            <DataGridTextColumn x:Name="ColUpdated" Header="Updated"
                        Binding="{Binding UpdatedAt}" IsReadOnly="True" Width="130"/>
                        </DataGrid.Columns>

                    </DataGrid>
                </DockPanel>
            </GroupBox>
        </Grid>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Close" Width="110" IsCancel="True" Style="{StaticResource ModernButton}"/>
        </StackPanel>
    </Grid>
</Window>
