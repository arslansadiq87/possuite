<UserControl x:Class="Pos.Client.Wpf.Windows.Settings.BarcodeLabelSettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" Width="1000" MaxWidth="1200">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <!-- Match the look of General/Invoice Settings: header, scope, main, actions -->
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Scope -->
            <RowDefinition Height="*"/>
            <!-- Main -->
            <RowDefinition Height="Auto"/>
            <!-- Actions -->
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,16">
            <StackPanel Orientation="Vertical" DockPanel.Dock="Left">
                <TextBlock Text="Barcode Labels" FontSize="18" FontWeight="SemiBold"/>
                <TextBlock Text="Design your barcode labels. Label printer is chosen in Invoice Settings (per counter)."
                           Opacity=".7"/>
            </StackPanel>
        </DockPanel>

        <!-- SCOPE -->
        <Border DockPanel.Dock="Right" Grid.Row="1" CornerRadius="4" Padding="0,6" Margin="0,16,0,16" Background="#0F000000" BorderBrush="#22000000" BorderThickness="1">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" >
                <TextBlock Text="Scope:" VerticalAlignment="Center" Margin="8,0,16,0" FontWeight="SemiBold"/>
                <RadioButton Content="Global" VerticalAlignment="Center" Margin="0,0,8,0" IsChecked="{Binding IsGlobal}" GroupName="Scope"/>

                <RadioButton Content="Specific outlet" VerticalAlignment="Center" Margin="0,0,8,0" IsChecked="{Binding IsOutlet}" GroupName="Scope"/>

                <ComboBox Width="220" Height="26" VerticalContentAlignment="Center" VerticalAlignment="Center"
          ItemsSource="{Binding Outlets}" SelectedItem="{Binding SelectedOutlet}" DisplayMemberPath="Name" IsEnabled="{Binding CanEditGlobal}" Margin="8,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- MAIN -->
        <ScrollViewer Grid.Row="2" Padding="0,0,0,8">
            <StackPanel Orientation="Vertical" Width="1000" MaxWidth="1200">

                <!-- PRINTER (read-only name from Invoice Settings) -->
                <GroupBox Header="Printer" Margin="0,0,0,8">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="80"/>
                            <!-- "DPI:" label -->
                            <ColumnDefinition Width="*"/>
                            <!-- DPI combo -->
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Label Printer:" VerticalAlignment="Center"/>
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="{Binding SelectedLabelPrinter}" FontWeight="SemiBold"/>
                            <TextBlock Text="  (set in Invoice Settings)" Margin="6,0,0,0" Opacity=".6"/>
                        </StackPanel>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="DPI:" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="8,0,8,0"/>
                        <ComboBox  Grid.Row="0" Grid.Column="3" Width="120" ItemsSource="{Binding DpiOptions}" SelectedItem="{Binding Dpi}"/>
                    </Grid>
                </GroupBox>


                <!-- GEOMETRY -->
                <GroupBox Header="Label Geometry (mm)" Margin="0,0,0,8">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Label Width:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding LabelWidthMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Label Height:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="0" Grid.Column="3" Text="{Binding LabelHeightMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Horizontal Gap:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="1" Grid.Column="1" Text="{Binding HorizontalGapMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Vertical Gap:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="1" Grid.Column="3" Text="{Binding VerticalGapMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Left Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="2" Grid.Column="1" Text="{Binding MarginLeftMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="2" Text="Top Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="2" Grid.Column="3" Text="{Binding MarginTopMm}" Width="100" Margin="8,0,0,0"/>
                    </Grid>
                </GroupBox>

                <!-- GRID (SHEETS) -->
                <GroupBox Header="Grid (for sheets – use 1×1 for rolls)" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal" Margin="10,8,10,10">
                        <TextBlock Text="Columns:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding Columns}" Width="80" Margin="8,0,16,0"/>
                        <TextBlock Text="Rows:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding Rows}" Width="80" Margin="8,0,16,0"/>
                    </StackPanel>
                </GroupBox>

                <!-- CONTENT -->
                <GroupBox Header="Content" Margin="0,0,0,8">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Code/Font row -->
                            <RowDefinition Height="Auto"/>
                            <!-- 4-column toggles + aligns -->
                        </Grid.RowDefinitions>

                        <!-- Row 0: Code type + Font size -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Code Type:" VerticalAlignment="Center"/>
                            <ComboBox  Grid.Column="1" Width="160" Margin="8,0,0,0"
                 ItemsSource="{Binding CodeTypes}"
                 SelectedItem="{Binding CodeType}"/>

                            <TextBlock Grid.Column="2" Text="Font Size (pt):" VerticalAlignment="Center"/>
                            <TextBox   Grid.Column="3" Text="{Binding FontSizePt}" Width="80" Margin="8,0,0,0"/>
                        </Grid>

                        <!-- Row 1: Four equal columns (Name, Price, SKU, Business) -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- NAME -->
                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <CheckBox Content="Show Name"
                  IsChecked="{Binding ShowName}"/>
                                <StackPanel Orientation="Horizontal"
                    Margin="0,6,0,0"
                    Visibility="{Binding ShowName, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="Align:" VerticalAlignment="Center"/>
                                    <ComboBox ItemsSource="{Binding AlignOptions}"
                    SelectedItem="{Binding NameAlign, Mode=TwoWay}"
                    Width="120" Margin="6,0,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- PRICE -->
                            <StackPanel Grid.Column="1" Orientation="Vertical">
                                <CheckBox Content="Show Price"
                  IsChecked="{Binding ShowPrice}"/>
                                <StackPanel Orientation="Horizontal"
                    Margin="0,6,0,0"
                    Visibility="{Binding ShowPrice, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="Align:" VerticalAlignment="Center"/>
                                    <ComboBox ItemsSource="{Binding AlignOptions}"
                    SelectedItem="{Binding PriceAlign, Mode=TwoWay}"
                    Width="120" Margin="6,0,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- SKU -->
                            <StackPanel Grid.Column="2" Orientation="Vertical">
                                <CheckBox Content="Show SKU"
                  IsChecked="{Binding ShowSku}"/>
                                <StackPanel Orientation="Horizontal"
                    Margin="0,6,0,0"
                    Visibility="{Binding ShowSku, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="Align:" VerticalAlignment="Center"/>
                                    <ComboBox ItemsSource="{Binding AlignOptions}"
                    SelectedItem="{Binding SkuAlign, Mode=TwoWay}"
                    Width="120" Margin="6,0,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- BUSINESS -->
                            <StackPanel Grid.Column="3" Orientation="Vertical">
                                <CheckBox Content="Show Business Name"
                  IsChecked="{Binding ShowBusinessName}"/>
                                <StackPanel Orientation="Horizontal"
                    Margin="0,6,0,0"
                    Visibility="{Binding ShowBusinessName, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="Align:" VerticalAlignment="Center"/>
                                    <ComboBox ItemsSource="{Binding AlignOptions}"
                    SelectedItem="{Binding BusinessAlign, Mode=TwoWay}"
                    Width="120" Margin="6,0,0,0"/>
                                </StackPanel>
                            </StackPanel>

                        </Grid>
                    </Grid>
                </GroupBox>


                <!-- BARCODE AREA -->
                <GroupBox Header="Barcode Area (mm)" Margin="0,0,0,8">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <!-- NEW: zoom row -->
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Left Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding BarcodeMarginLeftMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Top Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="0" Grid.Column="3" Text="{Binding BarcodeMarginTopMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Right Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="1" Grid.Column="1" Text="{Binding BarcodeMarginRightMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Bottom Margin:" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="1" Grid.Column="3" Text="{Binding BarcodeMarginBottomMm}" Width="100" Margin="8,0,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Fixed Height (mm):" VerticalAlignment="Center"/>
                        <TextBox   Grid.Row="2" Grid.Column="1" Text="{Binding BarcodeHeightMm}" Width="100" Margin="8,0,0,0"/>
                        <TextBlock Grid.Row="2" Grid.Column="2" Text="(0 = auto)" Opacity=".6" VerticalAlignment="Center"/>

                        <!-- NEW: Zoom controls -->
                        <StackPanel Grid.Row="3" Grid.ColumnSpan="4" Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="Barcode zoom:" VerticalAlignment="Center"/>
                            <Slider Minimum="60" Maximum="100" SmallChange="1" LargeChange="5"
              TickFrequency="10" IsSnapToTickEnabled="False"
              Width="220" Margin="8,0,10,0"
              Value="{Binding BarcodeZoomPct, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="{Binding BarcodeZoomPct, StringFormat={}{0:0}%}" VerticalAlignment="Center" Width="60"/>
                            <TextBlock Text="(width relative to area)" Opacity=".6" VerticalAlignment="Center" Margin="6,0,0,0"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>



                <!-- PREVIEW -->
                <GroupBox Header="Preview" Padding="10" Margin="0,8,0,0">
                    <StackPanel>
                        <Border BorderBrush="#DDD" BorderThickness="1" Padding="8" Background="White" HorizontalAlignment="Left">
                            <!-- Preview Surface -->
                            <Grid>
                                <Grid.LayoutTransform>
                                    <!-- Zoom factor from VM -->
                                    <ScaleTransform ScaleX="{Binding PreviewZoom}" ScaleY="{Binding PreviewZoom}" />
                                </Grid.LayoutTransform>

                                <!-- Rendered label -->
                                <Image x:Name="PreviewImage"
                                       Source="{Binding PreviewImage}"
                                       Width="{Binding PreviewWidthDip}"
                                       Height="{Binding PreviewHeightDip}"
                                       Stretch="None"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="NearestNeighbor"
                                       VerticalAlignment="Top"/>

                                <!-- Drag overlay -->
                                <Canvas Width="{Binding PreviewWidthDip}"
                                        Height="{Binding PreviewHeightDip}">

                                    <!-- Name handle -->
                                    <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                           ToolTip="Drag to position Item Name"
                                           Visibility="{Binding ShowName, Converter={StaticResource BoolToVis}}"
                                           DragDelta="OnDragDelta">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                    <TextBlock Text="N" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                        <Canvas.Left>
                                            <Binding Path="NameXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Left>
                                        <Canvas.Top>
                                            <Binding Path="NameYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Top>
                                        <FrameworkElement.Tag>
                                            <sys:String>Name</sys:String>
                                        </FrameworkElement.Tag>
                                    </Thumb>

                                    <!-- Price handle -->
                                    <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                           ToolTip="Drag to position Price"
                                           Visibility="{Binding ShowPrice, Converter={StaticResource BoolToVis}}"
                                           DragDelta="OnDragDelta">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                    <TextBlock Text="P" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                        <Canvas.Left>
                                            <Binding Path="PriceXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Left>
                                        <Canvas.Top>
                                            <Binding Path="PriceYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Top>
                                        <FrameworkElement.Tag>
                                            <sys:String>Price</sys:String>
                                        </FrameworkElement.Tag>
                                    </Thumb>

                                    <!-- SKU handle -->
                                    <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                           ToolTip="Drag to position SKU"
                                           Visibility="{Binding ShowSku, Converter={StaticResource BoolToVis}}"
                                           DragDelta="OnDragDelta">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                    <TextBlock Text="S" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                        <Canvas.Left>
                                            <Binding Path="SkuXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Left>
                                        <Canvas.Top>
                                            <Binding Path="SkuYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Top>
                                        <FrameworkElement.Tag>
                                            <sys:String>Sku</sys:String>
                                        </FrameworkElement.Tag>
                                    </Thumb>

                                    <!-- Business handle -->
                                    <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                           ToolTip="Drag to position Business Name"
                                           Visibility="{Binding ShowBusinessName, Converter={StaticResource BoolToVis}}"
                                           DragDelta="OnDragDelta">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                    <TextBlock Text="B" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                        <Canvas.Left>
                                            <Binding Path="BusinessXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Left>
                                        <Canvas.Top>
                                            <Binding Path="BusinessYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                        </Canvas.Top>
                                        <FrameworkElement.Tag>
                                            <sys:String>Business</sys:String>
                                        </FrameworkElement.Tag>
                                    </Thumb>

                                </Canvas>
                            </Grid>
                        </Border>

                        <!-- Sample inputs -->
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="Sample Code:" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SampleCode, UpdateSourceTrigger=PropertyChanged}" Width="160" Margin="8,0,8,0"/>

                            <TextBlock Text="Name:" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SampleName, UpdateSourceTrigger=PropertyChanged}" Width="160" Margin="8,0,8,0"/>

                            <TextBlock Text="Price:" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SamplePrice, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="8,0,8,0"/>

                            <TextBlock Text="SKU:" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SampleSku, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="8,0,0,0"/>
                        </StackPanel>

                        <TextBlock Text="Note: Preview respects label size and DPI. EAN-13/UPC need 12/11 digits (checksum auto-added). EAN-8 accepts 7/8 digits. Code-128 accepts ASCII."
                                   Opacity=".7" Margin="0,6,0,0"/>
                    </StackPanel>
                </GroupBox>

                <!-- PRINTER TOOLS (TSC) -->
                <Expander Header="Printer Tools (TSC)" Margin="0,8,0,0" IsExpanded="False"
                          Visibility="{Binding IsTscSelected, Converter={StaticResource BoolToVis}}">
                    <StackPanel Margin="8,6,8,8" Orientation="Vertical" >

                        <!-- MEDIA -->
                        <GroupBox Header="Media / Setup (applies on printer)" Margin="0,0,0,8">
                            <Grid Margin="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="180"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="180"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Width (mm):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="0" Grid.Column="1" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscMediaWidthMm, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="0" Grid.Column="2" Text="Height (mm):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="0" Grid.Column="3" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscMediaHeightMm, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Gap (mm):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="1" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscGapMm, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="1" Grid.Column="2" Text="Gap Offset (mm):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="3" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscGapOffsetMm, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Speed (1–5):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="2" Grid.Column="1" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscSpeed, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="2" Grid.Column="2" Text="Density (0–15):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="2" Grid.Column="3" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscDensity, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Direction (0/1):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="3" Grid.Column="1" Width="100" Margin="8,0,0,0"
                                           Text="{Binding TscDirection, UpdateSourceTrigger=PropertyChanged}"/>

                                <CheckBox  Grid.Row="3" Grid.Column="2" Content="Tear" IsChecked="{Binding TscTear}" VerticalAlignment="Center"/>
                                <CheckBox  Grid.Row="3" Grid.Column="3" Content="Peel" IsChecked="{Binding TscPeel}" VerticalAlignment="Center"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Codepage:" VerticalAlignment="Center"/>
                                <ComboBox  Grid.Row="4" Grid.Column="1" Width="120" Margin="8,0,0,0"
                                           SelectedItem="{Binding TscCodepage}">
                                    <ComboBoxItem Content="437"/>
                                    <ComboBoxItem Content="850"/>
                                    <ComboBoxItem Content="852"/>
                                    <ComboBoxItem Content="1252"/>
                                </ComboBox>

                                <Button Grid.Row="4" Grid.Column="3" Content="Apply to Printer"
                                        HorizontalAlignment="Right" Width="160"
                                        Command="{Binding TscApplyMediaCommand}"/>
                            </Grid>
                        </GroupBox>

                        <!-- MOTION -->
                        <GroupBox Header="Motion" Margin="0,0,0,8">
                            <StackPanel Orientation="Horizontal" Margin="8">
                                <TextBlock Text="Nudge (mm):" VerticalAlignment="Center"/>
                                <TextBox Width="60" Margin="8,0,12,0" Text="{Binding NudgeMm, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.0}}"/>
                                <Button Content="⬆ Forward"  Width="110" Margin="0,0,8,0" Command="{Binding TscFeedMmCommand}"/>
                                <Button Content="⬇ Backward" Width="110" Margin="0,0,8,0" Command="{Binding TscBackfeedMmCommand}"/>
                                <Button Content="Next Label" Width="110" Margin="0,0,8,0" Command="{Binding TscNextLabelCommand}"/>
                                <Button Content="Home" Width="90" Margin="0,0,8,0" Command="{Binding TscHomeCommand}"/>
                                <Button Content="Auto Detect" Width="120" Command="{Binding TscAutodetectCommand}"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- SOUND -->
                        <GroupBox Header="Sound" Margin="0,0,0,8">
                            <StackPanel Orientation="Horizontal" Margin="8">
                                <TextBlock Text="Times:" VerticalAlignment="Center"/>
                                <TextBox Width="50" Margin="8,0,12,0" Text="{Binding TscBeepTimes, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBlock Text="Duration (ms):" VerticalAlignment="Center"/>
                                <TextBox Width="60" Margin="8,0,12,0" Text="{Binding TscBeepMs, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button Content="Beep" Width="90" Command="{Binding TscBeepCommand}"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- QUICK LABEL -->
                        <GroupBox Header="Quick Label (TSPL direct)" Margin="0,0,0,8">
                            <Grid Margin="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Text:" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="0" Grid.Column="1" Margin="8,0,0,0"
                                           Text="{Binding QuickText, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="0" Grid.Column="2" Text="Barcode Type:" VerticalAlignment="Center"/>
                                <ComboBox  Grid.Row="0" Grid.Column="3" Width="140" Margin="8,0,0,0"
                                           ItemsSource="{Binding QuickBarcodeTypes}"
                                           SelectedItem="{Binding QuickBarcodeType}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Barcode Data:" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="1" Margin="8,0,0,0"
                                           Text="{Binding QuickBarcodeData, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="1" Grid.Column="2" Text="Height (mm):" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="3" Width="100" Margin="8,0,0,0"
                                           Text="{Binding QuickBarcodeHeightMm, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Copies:" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="2" Grid.Column="1" Width="80" Margin="8,0,0,0"
                                           Text="{Binding QuickCopies, UpdateSourceTrigger=PropertyChanged}"/>

                                <Button Grid.Row="2" Grid.Column="3" Content="Print Quick Label"
                                        HorizontalAlignment="Right" Width="160"
                                        Command="{Binding TscQuickLabelCommand}"/>
                            </Grid>
                        </GroupBox>

                        <!-- ADVANCED -->
                        <GroupBox Header="Advanced (experts)" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <TextBlock Text="Use Apply to Printer to push SIZE/GAP/SPEED/DENSITY/DIRECTION/TEAR/PEEL/CODEPAGE to the device. Quick Label uses TSPL directly."
                                           Opacity=".7"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </Expander>

            </StackPanel>
        </ScrollViewer>

        <!-- ACTIONS -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="Test Print" Width="120" Margin="0,0,8,0"
                    Command="{Binding TestPrintCommand}"/>
            <Button Content="Save" Width="100" Command="{Binding SaveCommand}"/>
            <Button Content="Reset" Width="100" Margin="8,0,0,0" Command="{Binding ResetCommand}"/>
        </StackPanel>

    </Grid>
</UserControl>
