<UserControl x:Class="Pos.Client.Wpf.Windows.Settings.BarcodeLabelSettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d">
    <ScrollViewer Padding="16">
        <StackPanel Orientation="Vertical" Width="800" MaxWidth="1000" >

            <TextBlock Text="Barcode Label Settings" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>

            <!-- Scope -->
            <!-- Scope -->
            <GroupBox Header="Scope">
                <StackPanel>
                    <RadioButton Content="Global (all outlets)"
      GroupName="Scope"
      IsChecked="{Binding IsGlobal}"/>

                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <RadioButton Content="Specific outlet:"
        GroupName="Scope"
        IsChecked="{Binding IsOutlet}"/>
                        <ComboBox Width="220" Margin="8,0,0,0"
     ItemsSource="{Binding Outlets}"
     SelectedItem="{Binding SelectedOutlet}"
     DisplayMemberPath="Name"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Printer -->
            <GroupBox Header="Printer" Margin="0,0,0,8">
                <StackPanel>
                    <ComboBox ItemsSource="{Binding InstalledPrinters}"
                              SelectedItem="{Binding PrinterName}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="DPI:" VerticalAlignment="Center"/>
                        <ComboBox Width="120" Margin="8,0,0,0"
                                  ItemsSource="{Binding DpiOptions}"
                                  SelectedItem="{Binding Dpi}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Geometry -->
            <GroupBox Header="Label Geometry (mm)" Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Label Width:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding LabelWidthMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Label Height:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="3" Text="{Binding LabelHeightMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Horizontal Gap:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="1" Grid.Column="1" Text="{Binding HorizontalGapMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Vertical Gap:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="1" Grid.Column="3" Text="{Binding VerticalGapMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Left Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="2" Grid.Column="1" Text="{Binding MarginLeftMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="2" Text="Top Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="2" Grid.Column="3" Text="{Binding MarginTopMm}" Width="100" Margin="8,0,0,0"/>
                </Grid>
            </GroupBox>

            <!-- Grid (for sheets) -->
            <GroupBox Header="Grid (for sheets – use 1×1 for rolls)" Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Columns:" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding Columns}" Width="80" Margin="8,0,16,0"/>
                    <TextBlock Text="Rows:" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding Rows}" Width="80" Margin="8,0,16,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Content -->
            <GroupBox Header="Content" Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Code Type:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="0" Grid.Column="1" Width="160" Margin="8,0,0,0"
                              ItemsSource="{Binding CodeTypes}" SelectedItem="{Binding CodeType}"/>

                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Font Size (pt):" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="3" Text="{Binding FontSizePt}" Width="80" Margin="8,0,0,0"/>

                    <StackPanel Grid.Row="1" Grid.ColumnSpan="4" Orientation="Horizontal" Margin="0,8,0,0">
                        <CheckBox Content="Show Name"  IsChecked="{Binding ShowName}" Margin="0,0,16,0"/>
                        <CheckBox Content="Show Price" IsChecked="{Binding ShowPrice}" Margin="0,0,16,0"/>
                        <CheckBox Content="Show SKU"   IsChecked="{Binding ShowSku}"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
            <GroupBox Header="Barcode Area (mm)" Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Left Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding BarcodeMarginLeftMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Top Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="3" Text="{Binding BarcodeMarginTopMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Right Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="1" Grid.Column="1" Text="{Binding BarcodeMarginRightMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Bottom Margin:" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="1" Grid.Column="3" Text="{Binding BarcodeMarginBottomMm}" Width="100" Margin="8,0,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Fixed Height (mm):" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="2" Grid.Column="1" Text="{Binding BarcodeHeightMm}" Width="100" Margin="8,0,0,0"/>
                    <TextBlock Grid.Row="2" Grid.Column="2" Text="(0 = auto)" Opacity=".6" VerticalAlignment="Center"/>
                </Grid>
            </GroupBox>

            <GroupBox Header="Business Name" Margin="0,0,0,8">
                <StackPanel>
                    <CheckBox Content="Show Business Name" IsChecked="{Binding ShowBusinessName}" />
                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBlock Text="Text:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding BusinessName, UpdateSourceTrigger=PropertyChanged}" Width="260" Margin="8,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Preview" Padding="10" Margin="0,8,0,0">
                <StackPanel>
                    <!-- Live bitmap preview -->
                    <Border BorderBrush="#DDD" BorderThickness="1" Padding="8" Background="White" HorizontalAlignment="Left">
                        <!-- Preview Surface -->
                        <Grid>
                            <!-- The rendered label image -->
                            <Image x:Name="PreviewImage"
                               Source="{Binding PreviewImage}"
                               Width="{Binding PreviewWidthDip}"
                               Height="{Binding PreviewHeightDip}"
                               Stretch="None"
                               SnapsToDevicePixels="True"
                               RenderOptions.BitmapScalingMode="NearestNeighbor" VerticalAlignment="Top"/>


                            <!-- Drag overlay -->
                            <Canvas Width="{Binding PreviewWidthDip}"
                                Height="{Binding PreviewHeightDip}">
                                <!-- Name handle -->
                                <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                     ToolTip="Drag to position Item Name"
                                     DragDelta="OnDragDelta">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                <TextBlock Text="N" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                    <Canvas.Left>
                                        <Binding Path="NameXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Left>
                                    <Canvas.Top>
                                        <Binding Path="NameYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Top>
                                    <FrameworkElement.Tag>
                                        <sys:String>Name</sys:String>
                                    </FrameworkElement.Tag>
                                </Thumb>

                                <!-- Price handle -->
                                <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                     ToolTip="Drag to position Price"
                                     DragDelta="OnDragDelta">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                <TextBlock Text="P" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                    <Canvas.Left>
                                        <Binding Path="PriceXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Left>
                                    <Canvas.Top>
                                        <Binding Path="PriceYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Top>
                                    <FrameworkElement.Tag>
                                        <sys:String>Price</sys:String>
                                    </FrameworkElement.Tag>
                                </Thumb>

                                <!-- SKU handle -->
                                <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                     ToolTip="Drag to position SKU"
                                     DragDelta="OnDragDelta">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                <TextBlock Text="S" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                    <Canvas.Left>
                                        <Binding Path="SkuXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Left>
                                    <Canvas.Top>
                                        <Binding Path="SkuYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Top>
                                    <FrameworkElement.Tag>
                                        <sys:String>Sku</sys:String>
                                    </FrameworkElement.Tag>
                                </Thumb>

                                <!-- BUSINESS handle -->
                                <Thumb Width="20" Height="20" Background="#CC333333" Cursor="SizeAll"
                                   ToolTip="Drag to position Business Name"
                                   Visibility="{Binding ShowBusinessName, Converter={StaticResource BooleanToVisibilityConverter}}"
                                   DragDelta="OnDragDelta">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10">
                                                <TextBlock Text="B" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                    <Canvas.Left>
                                        <Binding Path="BusinessXDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Left>
                                    <Canvas.Top>
                                        <Binding Path="BusinessYDip" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                    </Canvas.Top>
                                    <FrameworkElement.Tag>
                                        <sys:String>Business</sys:String>
                                    </FrameworkElement.Tag>
                                </Thumb>

                            </Canvas>
                        </Grid>
                    </Border>


                    <!-- Optional: sample inputs so user can see real content -->
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="Sample Code:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding SampleCode, UpdateSourceTrigger=PropertyChanged}" Width="160" Margin="8,0,8,0"/>

                        <TextBlock Text="Name:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding SampleName, UpdateSourceTrigger=PropertyChanged}" Width="160" Margin="8,0,8,0"/>

                        <TextBlock Text="Price:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding SamplePrice, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="8,0,8,0"/>

                        <TextBlock Text="SKU:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding SampleSku, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="8,0,0,0"/>
                    </StackPanel>

                    <TextBlock Text="Note: Preview respects label size and DPI. EAN-13/UPC need 12/11 digits (checksum auto-added). Code-128 accepts ASCII."
               Opacity=".7" Margin="0,6,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Actions -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                <Button Content="Test Print" Width="120" Margin="0,0,8,0"
                        Command="{Binding TestPrintCommand}"/>
                <Button Content="Save" Width="100" Command="{Binding SaveCommand}"/>
                <Button Content="Reset" Width="100" Margin="8,0,0,0" Command="{Binding ResetCommand}"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</UserControl>
