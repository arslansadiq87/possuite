<Window x:Class="Pos.Client.Wpf.Windows.Purchases.EditPurchaseWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Amend Purchase" Height="720" Width="1000"
        WindowStartupLocation="CenterOwner"
        KeyDown="Window_KeyDown">



    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Lines -->
            <RowDefinition Height="Auto"/>
            <!-- Totals -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1.4*"/>
                <ColumnDefinition Width="1.2*"/>
                <ColumnDefinition Width="1.2*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,10,0">
                <TextBlock Text="Supplier" FontWeight="Bold"/>
                <TextBlock x:Name="SupplierNameText" Text="-" />
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Vertical" Margin="0,0,10,0">
                <TextBlock Text="Vendor Invoice #" FontWeight="Bold"/>
                <TextBox x:Name="VendorInvBox" />
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Vertical" Margin="0,0,10,0">
                <TextBlock Text="Purchase Date" FontWeight="Bold"/>
                <DatePicker x:Name="DatePicker"/>
            </StackPanel>

            <StackPanel Grid.Column="3" Orientation="Vertical">
                <TextBlock Text="Doc No" FontWeight="Bold"/>
                <TextBlock x:Name="DocNoText" Text="—"/>
            </StackPanel>
        </Grid>

        <!-- Lines -->
        <DataGrid x:Name="LinesGrid" Grid.Row="1"
                  AutoGenerateColumns="False" CanUserAddRows="False"
                  HeadersVisibility="Column" IsReadOnly="False"
                  CellEditEnding="LinesGrid_CellEditEnding"
                  RowEditEnding="LinesGrid_RowEditEnding">
            <DataGrid.Columns>
                <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" IsReadOnly="True" Width="120"/>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" IsReadOnly="True" Width="*"/>
                <DataGridTextColumn Header="Qty" Binding="{Binding Qty, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="80"/>
                <DataGridTextColumn Header="Price" Binding="{Binding UnitCost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                <DataGridTextColumn Header="Disc" Binding="{Binding Discount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="80"/>
                <DataGridTextColumn Header="Tax %" Binding="{Binding TaxRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="80"/>
                <DataGridTextColumn Header="Line Total" Binding="{Binding LineTotal}" IsReadOnly="True" Width="110"/>
                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="150"/>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="3" Margin="0,0,0,0" Padding="12"
            BorderBrush="#DDD" BorderThickness="1" CornerRadius="8"
            Background="#FAFAFA">

            <Grid>
                <!-- Row 0: content | Row 1: buttons -->
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <!-- ===== Row 0: CONTENT (3 columns) ===== -->
                <Grid Grid.Column="0">
                    <StackPanel Grid.Column="1" Margin="0,0,0,0" VerticalAlignment="Bottom">
                        <GroupBox Header="Payments" Width="322">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Advance:" Margin="0,0,6,0"/>
                                    <TextBox x:Name="PayAmountBox" Width="80"/>
                                    <ComboBox x:Name="PayMethodBox" Width="77" Margin="6,0,0,0" SelectedIndex="0">
                                        <ComboBoxItem Content="Cash"/>
                                        <ComboBoxItem Content="Card"/>
                                        <ComboBoxItem Content="Bank"/>
                                        <ComboBoxItem Content="Other"/>
                                    </ComboBox>
                                    <Button Content="Add Advance" Margin="6,0,0,0" Click="AddPayment_Click" Width="85"/>
                                </StackPanel>

                                <DataGrid x:Name="PaymentsGrid" AutoGenerateColumns="False" Height="120" Margin="0,6,0,0"
          CanUserAddRows="False" IsReadOnly="True" MouseDoubleClick="PaymentsGrid_MouseDoubleClick">
                                    <DataGrid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Edit…" Click="EditPayment_Click"/>
                                            <Separator />
                                            <MenuItem Header="Delete" Click="DeletePayment_Click"/>
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Kind" Binding="{Binding Kind}"/>
                                        <DataGridTextColumn Header="Method" Binding="{Binding Method}"/>
                                        <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=N2}"/>
                                        <DataGridTextColumn Header="When (UTC)" Binding="{Binding TsUtc}"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>



                </Grid>

                <!-- ===== Row 1: BUTTONS BAR ===== -->
                <Grid  Grid.Column="1" Margin="0,2,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid Grid.Column="0">
                                    <Grid Margin="16,12,0,0" VerticalAlignment="Top">
                                        <CheckBox x:Name="IsDraftBox" Content="Save as Draft (no stock)"/>
                                    </Grid>
                                </Grid>

                                <GroupBox  Header="Totals" Padding="8" Margin="0,0,0,8" HorizontalAlignment="Right" Width="345" Grid.ColumnSpan="2">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <!-- Row 0 -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="SubtotalText"/>
                                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Discount:" FontWeight="SemiBold" Margin="12,0,8,0"/>
                                        <TextBlock Grid.Row="0" Grid.Column="3" x:Name="DiscountText"/>
                                        <!-- Row 1 -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Tax:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TaxText"/>
                                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Other:" FontWeight="SemiBold" Margin="12,0,8,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="3" x:Name="OtherChargesBox"
TextChanged="OtherChargesBox_TextChanged" Margin="0,0,0,16" Grid.RowSpan="2"/>
                                        <!-- Row 2 -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Grand Total:" FontWeight="Bold" Margin="0,0,8,0"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="GrandTotalText" FontWeight="Bold"/>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </Grid>
                        <Grid Grid.Row="1">
                            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,2,0,0">
                                <Button Content="Save (F9)" Margin="0,0,8,0" Click="Save_Click" Width="150" Height="40" Style="{StaticResource Btn.GlobalPrimary}" />
                                <Button Content="Cancel (Esc)" Click="Cancel_Click" Width="150" Height="40" Style="{StaticResource Btn.GlobalPrimary}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>
        </Border>


    </Grid>
</Window>
