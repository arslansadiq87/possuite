<UserControl
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:controls="clr-namespace=Pos.Client.Wpf.Controls"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:Controls="clr-namespace:Pos.Client.Wpf.Controls" x:Class="Pos.Client.Wpf.Windows.Inventory.TransferEditorView"
             xmlns:nav="clr-namespace:System.Windows.Navigation;assembly=PresentationFramework"
             nav:JournalEntry.KeepAlive="True"
             mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="760">

    <DockPanel>
        <!-- Header -->
        <ToolBar DockPanel.Dock="Top">
            <!-- Only these three actions on the editor -->
            <Button Content="Save Draft" Width="110" Margin="8,0,0,0" Click="BtnSaveDraft_Click"/>
            <Button Content="Post" Width="100" Margin="8,0,0,0" Click="BtnDispatch_Click"/>

            <Button x:Name="BtnClear" Content="Clear" Width="90" Margin="8,0,0,0" Click="BtnClear_Click"/>

        </ToolBar>
        <Border DockPanel.Dock="Top" Padding="10" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
            <StackPanel Orientation="Horizontal">

                
                <TextBlock Text="Source:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox x:Name="FromTypeBox" Width="100"/>

                <ComboBox x:Name="FromPicker"                    
                    SelectedValuePath="Id"
                    DisplayMemberPath="Name"
                    Width="150"/>

                    <TextBlock Text="Destination:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox x:Name="ToTypeBox" Width="100"/>

                <ComboBox x:Name="ToPicker"
                    SelectedValuePath="Id"
                    DisplayMemberPath="Name"
                    Width="150"/>

                <TextBlock Text="Date:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <DatePicker x:Name="EffectiveDate" Width="140"/>

                <CheckBox x:Name="AutoReceiveCheck"
                    Content="Post + deliver (auto receive at destination)"
                    VerticalAlignment="Center" Margin="10,0,0,0"/>



            </StackPanel>
        </Border>
        <!-- Search/Add -->
        <Border DockPanel.Dock="Top" Padding="2" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Search Item:" VerticalAlignment="Center" Margin="0,0,6,0"/>

                <Controls:ItemSearchBox x:Name="ItemSearch" ItemPicked="ItemSearch_ItemPicked"
                                Width="360" Margin="0,0,8,0"/>
                
               

                <!-- Available badge (unchanged) -->
                <!-- Available badge (reusable control) -->
                <Controls:StockAvailableBadge x:Name="AvailBadge"
                              Visibility="Collapsed" 
                                Mode="AvailableForIssue"/>

            </StackPanel>
        </Border>


        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- LINES GRID – name the Qty and Note columns, and hook editing events -->
            <DataGrid x:Name="LinesGrid" Style="{StaticResource ModernDataGrid}"
          AutoGenerateColumns="False"
          CanUserAddRows="False" CanUserDeleteRows="True"
          HeadersVisibility="Column"
          SelectionChanged="LinesGrid_SelectionChanged"
          PreviewKeyDown="LinesGrid_PreviewKeyDown"
          PreparingCellForEdit="LinesGrid_PreparingCellForEdit"
          CellEditEnding="LinesGrid_CellEditEnding"
          LostKeyboardFocus="LinesGrid_LostKeyboardFocus"
          KeyDown="LinesGrid_KeyDown">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Item" Binding="{Binding ItemNameSnapshot}" Width="*"
                        IsReadOnly="True"/>
                    <DataGridTextColumn x:Name="QtyColumn"
                        Header="Qty"
                        Binding="{Binding QtyExpected, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.####}}"
                        Width="110"/>
                    <DataGridTextColumn x:Name="NoteColumn"
                        Header="Note"
                        Binding="{Binding Remarks}"
                        Width="250"/>
                    <DataGridTemplateColumn Header="" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Delete" Padding="6,2" Click="DeleteLine_Click"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                <TextBlock Text="Lines:"/>
                <TextBlock x:Name="LinesCountText" FontWeight="SemiBold" Margin="6,0,0,0"/>
            </StackPanel>
            
        </Grid>

    </DockPanel>
</UserControl>
