<Window x:Class="Pos.Client.Wpf.Windows.Accounting.CashBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:Pos.Client.Wpf.Converters"
          xmlns:persist="clr-namespace:Pos.Domain.Models.Accounting;assembly=Pos.Domain"
        Title="Cash Book" Height="560" Width="980"
        WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <conv:UtcToDisplayTimeConverter x:Key="UtcTimeConv"/>

        <!-- NEW: fade + italic for voided rows -->
        <Style x:Key="VoidedRowStyle" TargetType="DataGridRow">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsVoided}" Value="True">
                    <Setter Property="Opacity" Value="0.6"/>
                    <Setter Property="FontStyle" Value="Italic"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel Margin="10">
        <!-- Filters -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center" >
            <TextBlock Text="Outlet:" Margin="0,0,6,0" VerticalAlignment="Center"/>
            <ComboBox Width="220" ItemsSource="{Binding OutletChoices}" SelectedItem="{Binding SelectedOutlet}" DisplayMemberPath="Name" />
            <TextBlock Text=" From:" Margin="12,0,6,0" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding FromDate}"/>
            <TextBlock Text=" To:" Margin="12,0,6,0" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding ToDate}"/>

            <TextBlock Text=" Scope:" Margin="12,0,6,0" VerticalAlignment="Center"/>
            <ComboBox Width="150"
          SelectedValue="{Binding Scope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
          SelectedValuePath="Tag">
                <ComboBoxItem Content="Cash in Hand" Tag="{x:Static persist:CashBookScope.HandOnly}" />
                <ComboBoxItem Content="Till"         Tag="{x:Static persist:CashBookScope.TillOnly}" />
                <ComboBoxItem Content="Both"         Tag="{x:Static persist:CashBookScope.Both}" />
            </ComboBox>

            <!-- NEW: include voided toggle -->
            <CheckBox Content="Include voided" Margin="12,0,0,0"
                      IsChecked="{Binding IncludeVoided, Mode=TwoWay}"/>

            <Button Content="Refresh" Margin="12,0,0,0" Command="{Binding RefreshCmd}"/>
        </StackPanel>

        <!-- Opening/Closing -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="Opening:" FontWeight="Bold"/>
            <TextBlock Text="{Binding Opening, StringFormat= 0.##}" Margin="6,0,24,0"/>
            <TextBlock Text="Closing:" FontWeight="Bold"/>
            <TextBlock Text="{Binding Closing, StringFormat= 0.##}" Margin="6,0,0,0"/>
        </StackPanel>

        <!-- Grid -->
        <DataGrid ItemsSource="{Binding Rows}" AutoGenerateColumns="False" CanUserAddRows="False" Style="{StaticResource ModernDataGrid}"
                  RowStyle="{StaticResource VoidedRowStyle}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Date/Time"
                    Binding="{Binding TsUtc, Converter={StaticResource UtcTimeConv}, ConverterParameter=yyyy-MM-dd HH:mm}" Width="*"/>
                <DataGridTextColumn Header="Memo" Binding="{Binding Memo}" Width="2*" />

                <!-- NEW: unified source column -->
                <DataGridTextColumn Header="Source" Binding="{Binding SourceRef}" Width="1.4*" />

                <DataGridTextColumn Header="Debit" Binding="{Binding Debit, StringFormat=0.##}" Width="*" />
                <DataGridTextColumn Header="Credit" Binding="{Binding Credit, StringFormat=0.##}" Width="*" />
                <DataGridTextColumn Header="Running" Binding="{Binding Running, StringFormat=0.##}" Width="*" />
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>
