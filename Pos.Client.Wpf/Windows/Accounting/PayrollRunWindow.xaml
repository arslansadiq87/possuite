<Window x:Class="Pos.Client.Wpf.Windows.Accounting.PayrollRunWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Payroll" Height="560" Width="920" WindowStartupLocation="CenterOwner">
    <DockPanel Margin="12">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="From:" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding FromDate}" Margin="6,0,12,0"/>
            <TextBlock Text="To:" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding ToDate}" Margin="6,0,12,0"/>

            <Button Content="Create Draft" Command="{Binding CreateDraftCommand}"/>
            <Button Content="Refresh" Margin="8,0,0,0" Command="{Binding RefreshCommand}" IsEnabled="{Binding HasRun}"/>
            <Button Content="Finalize" Margin="8,0,0,0" Command="{Binding FinalizeCommand}" IsEnabled="{Binding HasRun}"/>
            <Button Content="Pay" Margin="8,0,0,0" Command="{Binding PayCommand}" IsEnabled="{Binding HasRun}"/>
        </StackPanel>

        <DataGrid ItemsSource="{Binding Items}"
          AutoGenerateColumns="False"
          CanUserAddRows="False"
          IsReadOnly="{Binding IsRunFinalized, FallbackValue=True}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Staff" Binding="{Binding StaffName}" Width="2*"/>

                <!-- TwoWay for editable numeric cells -->
                <DataGridTextColumn Header="Basic"
                            Binding="{Binding Basic, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Width="120"/>
                <DataGridTextColumn Header="Allow"
                            Binding="{Binding Allowances, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Width="120"/>
                <DataGridTextColumn Header="OT"
                            Binding="{Binding Overtime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Width="120"/>
                <DataGridTextColumn Header="Deduct"
                            Binding="{Binding Deductions, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Width="120"/>

                <!-- Keep formatting on read-only column -->
                <DataGridTextColumn Header="Net"
                            Binding="{Binding Net, StringFormat=N2}"
                            Width="120"
                            IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <TextBlock Text="Gross:" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TotalGross, StringFormat=N2}" Margin="6,0,16,0" FontWeight="Bold"/>
            <TextBlock Text="Deductions:" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TotalDeductions, StringFormat=N2}" Margin="6,0,16,0" FontWeight="Bold"/>
            <TextBlock Text="Net:" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TotalNet, StringFormat=N2}" Margin="6,0,0,0" FontWeight="Bold"/>
        </StackPanel>
    </DockPanel>
</Window>
