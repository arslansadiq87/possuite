<UserControl x:Class="Pos.Client.Wpf.Controls.AccountSearchBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             MinHeight="0" MinWidth="0"
             PreviewMouseWheel="Root_PreviewMouseWheel">

    <Grid>
        <TextBox x:Name="Input"
             Text="{Binding SearchText, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
             GotFocus="Input_GotFocus"
             PreviewKeyDown="Input_PreviewKeyDown"/>

        <Popup x:Name="Popup"
           PlacementTarget="{Binding ElementName=Input}"
           StaysOpen="True"
           AllowsTransparency="True"
           Focusable="False">
            <Border Padding="0" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">

                <ListBox x:Name="List"
                 ItemsSource="{Binding Filtered, RelativeSource={RelativeSource AncestorType=UserControl}}"
                 Background="Transparent"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 PreviewMouseWheel="List_PreviewMouseWheel"
                 MaxHeight="{Binding DropDownMaxHeight, RelativeSource={RelativeSource AncestorType=UserControl}}">

                    <!-- No DataType: binds to whatever items expose Code/Name -->
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="6,4">
                                <TextBlock Text="{Binding Code}" FontWeight="SemiBold"/>
                                <TextBlock Text=" — " />
                                <TextBlock Text="{Binding Name}" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="ListItem_PreviewMouseLeftButtonDown"/>
                            <Setter Property="Focusable" Value="False"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>

            </Border>
        </Popup>
    </Grid>
</UserControl>
